<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Alternative Ways | Downloads</title>

  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/png" href="Resources/AW-Icon.png" />
  <meta name="theme-color" content="#070818" />
  <meta http-equiv="ScreenOrientation" content="autoRotate:disabled" />

  <style>
    /* =========================================
       DOWNLOADS ‚Äî page-only styles
       (HeadBar + FootBar bleiben extern!)
       ========================================= */
    :root{
      --bg0:#070818;
      --bg1:#0b0f2a;
      --text: rgba(238,240,255,.94);
      --muted: rgba(238,240,255,.72);
      --border: rgba(238,240,255,.10);
      --card: rgba(238,240,255,.04);
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --radius: 18px;
      --container: 1140px;
      --topbarH: 78px;
      --accent: #7C3AED;
      --accent2:#22D3EE;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      color: var(--text);
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(124,58,237,.25), transparent 60%),
        radial-gradient(900px 600px at 80% 20%, rgba(34,211,238,.18), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
    }
    a{ color:inherit; text-decoration:none; }

    .Page{
      padding-top: var(--topbarH);
      min-height: 100vh;
      width:100%;
    }
    .Wrap{
      width: min(var(--container), calc(100% - 40px));
      margin: 0 auto;
    }

    /* ---------- HERO ---------- */
    .DlHero{
      position: relative;
      margin-top: 18px;
      border-radius: 22px;
      border: 1px solid rgba(238,240,255,.12);
      overflow: hidden;
      box-shadow: var(--shadow);
      background:
        radial-gradient(900px 520px at 20% 20%, rgba(124,58,237,.25), transparent 60%),
        radial-gradient(900px 520px at 80% 30%, rgba(34,211,238,.18), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,.25));
    }
    .DlHero__inner{
      padding: 22px 22px 18px;
      display:grid;
      gap: 12px;
    }

    .Kicker{
      width: fit-content;
      display:inline-flex;
      align-items:center;
      gap: 10px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(238,240,255,.14);
      background: rgba(238,240,255,.06);
      color: rgba(238,240,255,.86);
      font-size: 12px;
      font-weight: 950;
      letter-spacing: .9px;
      text-transform: uppercase;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .Kicker__dot{
      width: 7px; height: 7px;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      box-shadow: 0 0 0 6px rgba(124,58,237,.14);
    }

    .DlHero__title{
      margin: 0;
      font-weight: 1000;
      letter-spacing: -0.02em;
      font-size: clamp(28px, 3.8vw, 46px);
      line-height: 1.05;
      text-shadow: 0 18px 60px rgba(0,0,0,.55);
    }
    .DlHero__lead{
      margin: 0;
      max-width: 78ch;
      color: rgba(238,240,255,.82);
      font-size: 15.5px;
      line-height: 1.55;
    }

    .Toolbar{
      margin-top: 8px;
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
      justify-content: space-between;
    }

    .Search{
      flex: 1 1 320px;
      display:flex;
      align-items:center;
      gap: 10px;
      border-radius: 16px;
      border: 1px solid rgba(238,240,255,.14);
      background: rgba(255,255,255,.06);
      padding: 10px 12px;
    }
    .Search input{
      width: 100%;
      border: 0;
      outline: none;
      background: transparent;
      color: rgba(238,240,255,.94);
      font-weight: 800;
      letter-spacing: .2px;
      font-size: 14px;
    }
    .Search input::placeholder{ color: rgba(238,240,255,.55); font-weight: 700; }

    .Btn{
      height: 42px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      padding: 0 14px;
      border-radius: 14px;
      border: 1px solid rgba(238,240,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(238,240,255,.92);
      font-weight: 950;
      letter-spacing: .2px;
      transition: transform .18s ease, background .18s ease, border-color .18s ease;
      white-space: nowrap;
      cursor: pointer;
      user-select:none;
    }
    .Btn:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.10);
      border-color: rgba(238,240,255,.22);
    }
    .Btn--primary{
      border-color: rgba(124,58,237,.40);
      background: linear-gradient(90deg, rgba(124,58,237,.45), rgba(34,211,238,.20));
    }

    /* ---------- SECTION ---------- */
    .Section{ padding: 18px 0 26px; }
    .SectionHead{
      display:flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 16px;
      margin: 12px 0 12px;
    }
    .SectionTitle{
      margin:0;
      font-size: 16px;
      font-weight: 1000;
      letter-spacing: .2px;
    }
    .SectionHint{
      margin:0;
      color: rgba(238,240,255,.68);
      font-size: 13.5px;
      line-height: 1.4;
    }

    /* ---------- GRID ---------- */
    .Grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }
    @media (max-width: 980px){ .Grid{ grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 560px){ .Grid{ grid-template-columns: 1fr; } }

    .Card{
      border-radius: 18px;
      border: 1px solid rgba(238,240,255,.10);
      background: rgba(238,240,255,.03);
      box-shadow: 0 0 0 1px rgba(0,0,0,.14) inset;
      overflow:hidden;
      transition: transform .18s ease, border-color .18s ease, background .18s ease;
    }
    .Card:hover{
      transform: translateY(-2px);
      border-color: rgba(124,58,237,.22);
      background: rgba(238,240,255,.045);
    }

    .CardBody{
      padding: 14px;
      display:grid;
      gap: 10px;
    }
    .CardTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
    }
    .CardTitle{
      margin:0;
      font-weight: 1000;
      letter-spacing: .2px;
      font-size: 15px;
      line-height: 1.25;
      min-width: 0;
    }
    .CardTitle span{
      display:block;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .Badge{
      height: 26px;
      display:inline-flex;
      align-items:center;
      padding: 0 10px;
      border-radius: 999px;
      border: 1px solid rgba(238,240,255,.12);
      background: rgba(0,0,0,.18);
      color: rgba(238,240,255,.80);
      font-weight: 900;
      font-size: 12px;
      letter-spacing: .2px;
      white-space: nowrap;
      flex: 0 0 auto;
    }

    .MetaRow{
      display:flex;
      flex-wrap: wrap;
      gap: 8px;
      color: rgba(238,240,255,.72);
      font-size: 13.2px;
      line-height: 1.35;
    }
    .MetaPill{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(238,240,255,.10);
      background: rgba(0,0,0,.14);
    }

    .CardActions{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 2px;
    }

    .DlBtn{
      height: 38px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 0 14px;
      border-radius: 14px;
      border: 1px solid rgba(238,240,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(238,240,255,.92);
      font-weight: 950;
      letter-spacing: .2px;
      transition: transform .18s ease, background .18s ease, border-color .18s ease;
      white-space: nowrap;
    }
    .DlBtn:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.10);
      border-color: rgba(238,240,255,.22);
    }
    .DlBtn--primary{
      border-color: rgba(34,211,238,.30);
      background: linear-gradient(90deg, rgba(124,58,237,.30), rgba(34,211,238,.20));
    }

    .State{
      margin-top: 14px;
      padding: 12px 14px;
      border-radius: 16px;
      border: 1px dashed rgba(238,240,255,.16);
      background: rgba(0,0,0,.14);
      color: rgba(238,240,255,.72);
      font-size: 13.6px;
      line-height: 1.5;
      display:none;
    }
    .State.is-on{ display:block; }

    .Divider{
      height: 1px;
      background: rgba(238,240,255,.08);
      margin: 14px 0 0;
    }
  </style>
</head>

<body>
  <div id="HeadBar"></div>

  <main class="Page">
    <div class="Wrap">

      <section class="DlHero" aria-label="Downloads Hero">
        <div class="DlHero__inner">
          <div class="Kicker"><span class="Kicker__dot" aria-hidden="true"></span>Alternative Ways ‚Ä¢ Downloads</div>
          <h1 class="DlHero__title">Downloads</h1>
          <p class="DlHero__lead"></p>

          <div class="Toolbar" aria-label="Downloads tools">
            <div class="Search" role="search">
              <span aria-hidden="true">‚åï</span>
              <input id="q" type="search" placeholder="Suche nach Datei (z.B. presskit, stageplot, logo‚Ä¶)" autocomplete="off" />
            </div>

            <button id="reload" class="Btn Btn--primary" type="button">Neu laden</button>
            <a class="Btn" href="contact.html">Direkt kontaktieren</a>
          </div>
        </div>
      </section>

      <section class="Section" aria-label="Downloads">
        <div class="SectionHead">
          <h2 class="SectionTitle">Dateien</h2>
          <p class="SectionHint" id="hint">Wird geladen‚Ä¶</p>
        </div>

        <div id="grid" class="Grid" aria-label="Download files grid"></div>

        <div id="state" class="State" role="status" aria-live="polite"></div>
        <div class="Divider"></div>
      </section>

    </div>
  </main>

  <div id="FootBar"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>
    $("#HeadBar").load("FixedPages/HeadBar.html");
    $("#FootBar").load("FixedPages/FootBar.html");
  </script>

  <script>
    // =========================
    // CONFIG
    // =========================
    const FEED = "https://script.google.com/macros/s/AKfycbzEt-EPZQq2A_VCX61zOMBzuzU9g1UFzO77DbHP3fgqmVCNQ54upD0zbtWsI1sA-SU6YA/exec?mode=list";

    // =========================
    // HELPERS
    // =========================
    const $ = (sel, root=document) => root.querySelector(sel);

    function fmtBytes(bytes){
      if(!Number.isFinite(bytes) || bytes <= 0) return "‚Äî";
      const units = ["B","KB","MB","GB","TB"];
      let n = bytes, i = 0;
      while(n >= 1024 && i < units.length-1){ n/=1024; i++; }
      const d = (i === 0) ? 0 : (n < 10 ? 1 : 0);
      return n.toFixed(d) + " " + units[i];
    }

    function fmtDate(iso){
      if(!iso) return "‚Äî";
      const d = new Date(iso);
      if(isNaN(d)) return "‚Äî";
      return d.toLocaleDateString("de-DE", { year:"numeric", month:"short", day:"2-digit" });
    }

    function safeText(s){ return String(s ?? ""); }

    // robust value pick
    function pickFirst(...vals){
      for(const v of vals){
        if(v === null || v === undefined) continue;
        const s = String(v).trim();
        if(s && s !== "#") return s;
      }
      return "";
    }

    function driveView(id){
      if(!id) return "";
      return "https://drive.google.com/file/d/" + encodeURIComponent(id) + "/view?usp=sharing";
    }

    function driveDl(id){
      if(!id) return "";
      return "https://drive.google.com/uc?export=download&id=" + encodeURIComponent(id);
    }

    function badgeFor(file){
      const mime = String(file?.mimeType || file?.mime || "").toLowerCase();
      const name = String(file?.name || file?.title || "");
      const ext = (name.match(/\.([a-z0-9]+)$/i)?.[1] || "").toUpperCase();

      if(mime.includes("folder")) return "FOLDER";
      if(mime.includes("pdf")) return "PDF";
      if(mime.includes("zip") || mime.includes("compressed")) return "ZIP";
      if(mime.startsWith("image/")) return ext || "IMG";
      if(mime.startsWith("audio/")) return ext || "AUDIO";
      if(mime.startsWith("video/")) return ext || "VIDEO";
      return ext || "FILE";
    }

    function cardHTML(file){
      try{
        const id = pickFirst(file?.id, file?.fileId, file?.file_id);
        const name = safeText(file?.name || file?.title || "Unbenannte Datei");

        const updatedRaw = pickFirst(file?.updated, file?.modifiedTime, file?.modified, file?.lastUpdated);
        const sizeRaw = Number(pickFirst(file?.size, file?.bytes, file?.fileSize, 0)) || 0;

        const badge = badgeFor(file);

        const viewUrl = pickFirst(
          file?.viewUrl,
          file?.webViewLink,
          file?.url,
          file?.link,
          id ? driveView(id) : ""
        ) || "#";

        const dlUrl = pickFirst(
          file?.downloadUrl,
          file?.webContentLink,
          file?.download,
          file?.downloadLink,
          id ? driveDl(id) : viewUrl
        ) || viewUrl;

        const size = fmtBytes(sizeRaw);
        const date = fmtDate(updatedRaw);

        return `
          <div class="Card">
            <div class="CardBody">
              <div class="CardTop">
                <h3 class="CardTitle" title="${name}">
                  <span>${name}</span>
                </h3>
                <span class="Badge">${badge}</span>
              </div>

              <div class="MetaRow">
                <span class="MetaPill">üì¶ ${size}</span>
                <span class="MetaPill">üóìÔ∏è ${date}</span>
              </div>

              <div class="CardActions">
                <a class="DlBtn DlBtn--primary" href="${dlUrl}" target="_blank" rel="noopener">Download</a>
                <a class="DlBtn" href="${viewUrl}" target="_blank" rel="noopener">Ansehen</a>
              </div>
            </div>
          </div>
        `;
      }catch(e){
        console.error("cardHTML failed", e, file);
        return "";
      }
    }

    // =========================
    // STATE
    // =========================
    let allFiles = [];

    function setState(msg, on=true){
      const el = $("#state");
      if(!el) return;
      el.textContent = msg;
      el.classList.toggle("is-on", !!on);
    }

    function setHint(msg){
      const el = $("#hint");
      if(el) el.textContent = msg;
    }

    function applyFilter(){
      const q = safeText($("#q")?.value).trim().toLowerCase();
      const filtered = !q
        ? allFiles
        : allFiles.filter(f => safeText(f?.name || f?.title).toLowerCase().includes(q));

      render(filtered);
    }

    function render(files){
      const grid = $("#grid");
      if(!grid) return;

      grid.innerHTML = files.map(cardHTML).filter(Boolean).join("");

      if(files.length === 0){
        setState("Keine Treffer. Tipp: Suchbegriff leeren.", true);
      }else{
        setState("", false);
      }
      setHint(`${files.length} Datei(en)`);
    }

    async function loadFiles(){
      setState("Lade Dateien‚Ä¶", true);
      setHint("Wird geladen‚Ä¶");

      try{
        const res = await fetch(FEED + "&cb=" + Date.now(), { cache:"no-store" });
        if(!res.ok) throw new Error("HTTP " + res.status);

        const data = await res.json();
        if(!data || data.ok !== true || !Array.isArray(data.files)){
          throw new Error("Unerwartetes JSON (keine files)");
        }

        allFiles = data.files.slice();

        // ‚úÖ HIER war dein Hauptbug: du hast nicht gerendert
        applyFilter();
        setState("", false);

      }catch(err){
        console.error(err);
        allFiles = [];
        render([]);
        setState(
          "Konnte die Dateien nicht laden. Check: Ordnerfreigabe, Web-App Zugriff ('Jeder'), und ob die Dateien selbst freigegeben sind.",
          true
        );
        setHint("Fehler beim Laden");
      }
    }

    // =========================
    // INIT
    // =========================
    document.addEventListener("DOMContentLoaded", () => {
      $("#reload")?.addEventListener("click", loadFiles);
      $("#q")?.addEventListener("input", applyFilter);
      loadFiles();
    });
  </script>
</body>
</html>
